---
title: 网络协议
date: 2019-07-30 13:07:21
tags:
categories: [网络协议]
---

网络协议
    TCP/IP协议簇: TCP,IP,UDP,ICMP,RIP,TELNET,FTP,SMTP,ARP,TFTP
    OSI模型: 应用层->表示层->会话层->传输层->网络层->数据链路层->物理层
    TCP/IP模型: 应用层->传输层->网络层->网络接口层



    http协议
    HTTP请求由状态行、请求头、请求正文三部分组成：
        状态行：包括请求方式Method、资源路径URL、协议版本Version；
        请求头：包括一些访问的域名、用户代理、Cookie等信息；
        请求正文：就是HTTP请求的数据。

    HTTP响应由三部分组成：状态行、响应头、响应正文；
        状态行：包括协议版本Version、状态码Status Code、回应短语；
        响应头：包括搭建服务器的软件，发送响应的时间，回应数据的格式等信息；
        响应正文：就是响应的具体数据。


    常见状态码的含义
        200---OK/请求已经正常处理完毕
        301---/请求永久重定向
        302---/请求临时重定向
        304---/请求被重定向到客户端本地缓存
        400---/客户端请求存在语法错误
        401---/客户端请求没有经过授权
        403---/客户端的请求被服务器拒绝，一般为客户端没有访问权限
        404---/客户端请求的URL在服务端不存在
        500---/服务端永久错误
        503---/服务端发生临时错误


14.http和https
    HTTP协议以明文方式发送内容，不提供任何方式的数据加密，如果攻击者截取了Web浏览器和网站服务器之间的传输报文，
    就可以直接读懂其中的信息，因此，HTTP协议不适合传输一些敏感信息，比如：信用卡号、密码等支付信息。

    安全套接字层超文本传输协议HTTPS，为了数据传输的安全，HTTPS在HTTP的基础上加入了SSL协议，SSL依靠证书来验证服务器的身份，
    并为浏览器和服务器之间的通信加密。
    HTTPS协议的主要作用可以分为两种：一种是建立一个信息安全通道，来保证数据传输的安全；另一种就是确认网站的真实性。
    SSL Secure Sockets Layer

    HTTPS和HTTP的区别主要如下：
    　　1、https协议需要到ca申请证书，一般免费证书较少，因而需要一定费用。
    　　2、http是超文本传输协议，信息是明文传输，https则是具有安全性的ssl加密传输协议。
    　　3、http和https使用的是完全不同的连接方式，用的端口也不一样，前者是80，后者是443。
    　　4、http的连接很简单，是无状态的；HTTPS协议是由SSL+HTTP协议构建的可进行加密传输、身份认证的网络协议，比http协议安全。

    客户端在使用HTTPS方式与Web服务器通信时有以下几个步骤
    　　（1）客户使用https的URL访问Web服务器，要求与Web服务器建立SSL连接。
    　　（2）Web服务器收到客户端请求后，会将网站的证书信息（证书中包含公钥）传送一份给客户端。
    　　（3）客户端的浏览器与Web服务器开始协商SSL连接的安全等级，也就是信息加密的等级。
    　　（4）客户端的浏览器根据双方同意的安全等级，建立会话密钥，然后利用网站的公钥将会话密钥加密，并传送给网站。
    　　（5）Web服务器利用自己的私钥解密出会话密钥。
    　　（6）Web服务器利用会话密钥加密与客户端之间的通信。


TCP与UDP
    UDP    
        User Datagram Protocol,用户数据报协议.
        主要作用：将网络数据压缩成数据包的形式。
        数据包：一个二进制数据的传输单位

        在发送端，UDP传送数据的速度仅仅是受应用程序生成数据的速度、计算机的能力和传输带宽的限制；
        在接收端，UDP把每个消息段放在队列中，应用程序每次从队列中读一个消息段。
        
        优势：速度快(减少了TCP协议中提供数据包分组、组装和排序的过程需要的时间消耗)
              较安全(被攻击者利用的漏洞就要少一些)
        劣势: 无法得知其是否安全，完整到达
        应用: DNS、TFTP、SNMP,在生活中音频、视频和普通数据都可以采用UDP协议来进行数据传输，比如腾讯QQ这些社交软件也多采用UDP。

    TCP 
        Transmission Control Protocol 传输控制协议
        主要作用：把数据流分割成适当长度的报文段
        优势：可靠性好
            1.当TCP发出一个段后，它启动一个定时器，等待目的端确认收到这个报文段。如果不能及时收到一个确认，
            将重发这个报文段。当TCP收到发自TCP连接另一端的数据，它将发送一个确认。TCP有延迟确认的功能，在此功能没有打开，
            则是立即确认。功能打开，则由定时器触发确认时间点。
            2.TCP将保持它首部和数据的检验和。这是一个端到端的检验和，目的是检测数据在传输过程中的任何变化。
            如果收到段的检验和有差错，TCP将丢弃这个报文段和不确认收到此报文段（希望发端超时并重发）
            3.既然TCP报文段作为IP数据报来传输，而IP数据报的到达可能会失序，因此TCP报文段的到达也可能会失序。
            如果必要，TCP将对收到的数据进行重新排序，将收到的数据以正确的顺序交给应用层。
            4.TCP的接收端必须丢弃重复的数据
            5.量控制。TCP连接的每一方都有固定大小的缓冲空间。TCP的接收端只允许另一端发送接收端缓冲区所能接纳的数据。
            这将防止较快主机致使较慢主机的缓冲区溢出。

        劣势：速度慢，占用系统资源高，易被攻击

        应用 HTTP、HTTPS、FTP等传输文件的协议，POP、SMTP等邮件传输的协议
            浏览器，用的HTTP FlashFXP，用的FTP Outlook，用的POP、SMTP Putty，用的Telnet、SSH QQ文件传输 

        三次握手(SYN=1表示请求连接)
            Client      Server
            1.   -------> SYN=1 seq=J
            2.   SYN=1,ACK=1,ack=J+1,seq=K  <------                通过ack=J+1，Client知道Server是支持TCP的，且理解了自己要建立TCP连接的意图
            3.  ------->ACK=1,ack=K+1                              通过ack=K+1，Server知道Client是支持TCP的，且确实是要建立TCP连接

            建立可靠的通信信道,双方确认自己与对方的发送与接收机能正常,确认双方都支持TCP，告知对方用TCP传输。

                    第一次握手：Client什么都不能确认；Server确认了对方发送正常
                    第二次握手：Client确认了：自己发送、接收正常，对方发送、接收正常；Server确认了：自己接收正常，对方发送正常
                    第三次握手：Client确认了：自己发送、接收正常，对方发送、接收正常；Server确认了：自己发送、接收正常，对方发送接收正常
            
        四次挥手
            Client      Server
            1.  ----->FIN M
            2. ack M+1 <---------
            3.FIN N   <--------
            4.------->ACK=1 ack=K+1

            一方发送FIN只表示自己发完了所有要发的数据，但还允许对方继续把没发完的数据发过来。
        
        拥塞控制
            拥塞控制是一个全局性的过程, 流量控制是点对点通信量的控制
            拥塞原因
                网络能够提供的资源不足以满足用户的需求，这些资源包括缓存空间、链路带宽容量和中间节点的处理能力。

            流量控制
                滑动窗口
                接受方管理发送方发送数据的方式，用来防止接受方可用的数据缓存空间的溢出

            重传
            1、一旦收到确认，发送方关闭重发定时器并且将数据片的备份从重发队列中删除。发送方如果在规定的时间内没有收到数据确认，就重传该数据。
            2、当TCP超时并重传时，它不一定要重传同样的报文段，相反，TCP允许进行重新分组而发送一个较大的报文段，这将有助于提高性能(当然，这个较大的报文段不能够超过接收方声明的MSS)。在协议中这是允许的，因为TCP是使用字节序号而不是报文段序号来进行识别它所要发送的数据和进行确认。
            3、重发定时器
            (1)  每一次一个包含数据的包被发送（包括重发），如果该定时器没有运行则启动它，使得它在RTO秒之后超时（按照当前的RTO值）。
            (2)  当所有的发出数据都被确认之后，关闭该重发定时器。
            (3)  当接收到一个ACK确认一个新的数据，重新启动该重发定时器，使得它在RTO秒之后超时（按照当前的RTO值）

            核心算法
                慢启动
                    先探测一下网络的拥塞程度，也就是由小到大逐渐增加拥塞窗口的大小 
                拥塞避免
                    拥塞窗口缓慢增长，即每经过一个往返时间RTT就把发送方的拥塞窗口cwnd加1，而不是加倍，这样拥塞窗口按线性规律缓慢增长

                无论是在慢开始阶段还是在拥塞避免阶段，只要发送方判断网络拥塞（没有收到确认，虽然没有收到确认可能是其他原因的分组丢失，
                但是因为无法判定，所以都当作拥塞来处理），就把慢开始门限设置为出现拥塞时的发送窗口大小的一半，然后把拥塞窗口设置为1，执行慢开始算法 


                快速重传
                    要求接收方在收到一个失序的报文端就立即发出重复确认（为的是使发送及早知道有报文段没有到达对方）
                    而不要等到自己发送数据时捎带确认

                    TCP协议保证数据可靠性的一个重要机制，其原理是在发送一个数据以后就开启一个计时器， 
                    在一定时间内如果没有得到发送数据报的ACK报文，那么就重新发送数据，直到发送成功为止。
                    一般来说，重传发生在超时之后，但是如果发送端接收到3个以上 
                    的重复ACK，就应该意识到，数据丢了，需要重新传递。这个机制不需要等到重传定时器溢出，所以叫做快重传

                快速恢复
                    快速重传以后，因为走的不是慢启动而是拥塞避免算法，所以叫快速恢复算法 




10.IP地址分类
    A: 0.0.0.0-127.255.255，其中段0和127不可用
         第一个字节为网络号，后三个字节为主机号。该类IP地址的最前面为“0”，所以地址的网络号取值于1~126之间。
     一般用于大型网络。
    B: 128.0.0.0-191.255.255.255
        前两个字节为网络号，后两个字节为主机号。该类IP地址的最前面为“10”，所以地址的网络号取值于128~191之间。
     一般用于中等规模网络。
    C: 192.0.0.0-223.255.255.255
             前三个字节为网络号，最后一个字节为主机号。该类IP地址的最前面为“110”，所以地址的网络号取值于192~223之间。
     一般用于小型网络。
    D: 224.0.0.0-239.255.255.255
        是多播地址。该类IP地址的最前面为“1110”，所以地址的网络号取值于224~239之间。一般用于多路广播用户
    E: 240.0.0.0-255.255.255.255，其中段255不可用
        是保留地址。该类IP地址的最前面为“1111”，所以地址的网络号取值于240~255之间。

       IP地址由四段组成，每个字段是一个字节，8位，最大值是255

       IP地址对应于OSI参考模型的第三层网络层，工作在网络层的路由器根据目标IP和源IP来判断是否属于同一网段，如果是不同网段，则转发数据包。

    MAC地址
        （Media Access Control，介质访问控制）地址，或称为物理地址，也叫硬件地址，用来定义网络设备的位置
            MAC地址采用十六进制数表示，长度是6个字节（48位），分为前24位和后24位。

            MAC地址对应于OSI参考模型的第二层数据链路层，工作在数据链路层的交换机维护着计算机MAC地址和自身端口的数据库，
            交换机根据收到的数据帧中的“目的MAC地址”字段来转发数据帧。    

        
        在数据通信时，IP地址专注于网络层，网络层设备（如路由器）根据IP地址，将数据包从一个网络传递转发到另外一个网络上；
        而MAC地址专注于数据链路层，数据链路层设备（如交换机）根据MAC地址，将一个数据帧从一个节点传送到相同链路的另一个节点上。
        IP和MAC地址这种映射关系由ARP（Address Resolution Protocol，地址解析协议）协议完成，ARP根据目的IP地址，找到中间节点的MAC地址，
        通过中间节点传送，从而最终到达目的网络。