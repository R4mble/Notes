---
title: Kafka
date: 2019-09-16 12:30:28
categories: [分布式]
---
"100个Hello World", 这是我看到有人在网络骂战中攻击别人博客时用到的话.
说者无心,听者有意. 立即反思自己的博客是不是有一天也会被评价为"100个Hello World".
程序员的焦虑程度往往比其它职业更严重, 从入行开始就有的终身学习, 随时会被淘汰.
害怕自己不是有十年经验, 而是一个经验用了十年.
最后还有个35岁的deadline.
所以为啥要写博客?
一方面是为了抵抗遗忘. 不管你对一个知识点理解的有多深刻, 曾经掌握的有多娴熟, 时间会无情地磨掉
你的记忆. 所以写写博客, 当个速查手册, 也是个存档, 要用到的时候翻一翻就能快速想起当年掌握它的时候
学会的点点滴滴.
另一方面是作为读书笔记, 读书的时候有个东西记一下, 能提升读书时的专注度.
遗憾的是看别人博客的时候并不会有这些感觉, 他读过的书写过的代码你没有感触
看别人的博客, 一般都是期待有博主特殊的见解: 

凡事总有个Hello World, 而且大部分技术80%以上的时间都是只是用它提供的最简单的一点功能.
来嘛, 100个Hello World.
Hello ~

## 用途
- 消息系统  
  系统解耦, 冗余存储, 流量削峰, 缓冲, 异步通信, 扩展性, 可恢复性, 消息顺序性保障, 回溯消费

- 存储系统  
  消息持久化到磁盘, 降低了数据丢失的风险.

- 流式处理平台  
  为流式处理框架提供数据来源, 提供完整的流失处理类库, 如窗口,连接,变换和聚合等

## 结构
Zookeeper: 管理集群元数据, 选举控制器
Producer将消息发送到Broker的特定主题,Broker将消息存储到磁盘中,Consumer从Broker订阅主题并消费消息.
Consumer使用拉模式从服务端拉取消息,并且保存消费的具体位置.当消费者宕机后恢复上线时可以根据之前保存的消费位置重新拉取
需要的消息进行消费, 这样就不会造成消息丢失.


主题可以分为多个分区,可以在多个broker上,不同分区包含的消息不同.
> Kafka保证分区有序而不是主题有序.

- 多副本机制  
  同一分区的不同副本保存的是相同的消息. 副本之间一主多从, leader负责读写, follower只负责与leader消息同步,
  当leader故障时,从follower中重新选举新的leader.

所有副本统称AR, 与leader副本保持一定程度同步的副本(包括leader在内)组成ISR, 与leader同步滞后过多的副本组成OSR
AR = ISR + OSR
正常情况下, ORS为空集.
leader负责维护follower副本的ISR和OSR转移, leader故障时从ISR中选举.